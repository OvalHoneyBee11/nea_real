{% extends "base.html" %}
{% block title %}EconSpark{% endblock %}

{% block content %}
<h1>Welcome {{ user.username }} to EconSpark</h1>

{% if user.is_teacher %}
<h2>Classes I Teach</h2>
{% else %}
<h2>My Classes</h2>
{% endif %}
<!-- Shows users classes-->
{% if user_classes %}
<ul style="list-style: none; padding: 0;">
    {% for user_class in user_classes %}
    <li style="margin-bottom: 1rem; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
        <h3 style="margin: 0 0 0.5rem 0;">{{ user_class.name }}</h3>
        <p style="margin: 0 0 0.5rem 0; color: #666;">{{ user_class.description }}</p>
        <p style="margin: 0 0 0.5rem 0;"><strong>Teacher:</strong> {{ user_class.teacher.username }}</p>
        <a href="{{ url_for('classes.class_detail', class_id=user_class.id) }}" class="btn btn-primary btn-sm">View
            Class →</a>
    </li>
    {% endfor %}
</ul>
{% else %}
<!-- Alternatives-->
{% if user.is_teacher %}
<p>You haven't created any classes yet.</p>
<a href="{{ url_for('classes.create_class') }}" class="btn btn-success">Create a Class</a>
{% else %}
<p>You are not enrolled in any classes yet.</p>
<a href="{{ url_for('classes.join_class') }}" class="btn btn-success">Join a Class</a>
{% endif %}
{% endif %}

<!-- User Question Sets -->
<h2>My Question Sets</h2>
{% if user_question_sets %}
<ul style="list-style: none; padding: 0;">
    {% for question_set in user_question_sets %}
    <li style="margin-bottom: 1rem; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
        <h3 style="margin: 0 0 0.5rem 0;">{{ question_set.name }}</h3>
        <p style="margin: 0 0 0.5rem 0; color: #666;">{{ question_set.description }}</p>
        <p style="margin: 0;"><strong>Questions:</strong> {{ question_set.questions|length }}</p>
        <a href="{{ url_for('tests.questions', set_id=question_set.id) }}" class="btn btn-primary btn-sm">View Questions
            →</a>
    </li>
    {% endfor %}
</ul>
{% else %}
<!-- Alternative if no question sets-->
<p>You have not created any question sets yet.</p>
<a href="{{ url_for('tests.create_question_set') }}" class="btn btn-success">Create a Question Set</a>
{% endif %}

<!-- News Stories Section -->
<hr style="margin: 2rem 0;">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h2 style="margin: 0;">News Stories</h2>
    <a href="{{ url_for('sn.news') }}" class="btn btn-info btn-sm">View All News →</a>
</div>

{% if articles %}
<div style="display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem;">
    {% for article in articles %}
    <div style="min-width: 250px; max-width: 250px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9; flex-shrink: 0;">
        {% if article.urlToImage %}
        <img src="{{ article.urlToImage }}" alt="{{ article.title }}" 
             style="width: 100%; height: 120px; object-fit: cover; border-radius: 4px; margin-bottom: 0.5rem;">
        {% endif %}
        <h5 style="margin: 0 0 0.5rem 0; font-size: 0.9rem; line-height: 1.2;">
            <a href="{{ article.url }}" target="_blank" style="color: #007bff; text-decoration: none;">
                {{ article.title[:80] }}{% if article.title|length > 80 %}...{% endif %}
            </a>
        </h5>
        <p style="margin: 0 0 0.5rem 0; font-size: 0.75rem; color: #666;">
            <strong>{{ article.source.name }}</strong>
        </p>
        {% if article.description %}
        <p style="margin: 0; font-size: 0.75rem; color: #555; line-height: 1.3;">
            {{ article.description[:100] }}{% if article.description|length > 100 %}...{% endif %}
        </p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p>No news articles available at the moment.</p>
{% endif %}

{% endblock %}