{% extends "base.html" %}
{% block title %}Flashcards - {{ question_set.name }}{% endblock %}

{% block content %}
<!-- Flashcards Template -->
<style>
    .flashcard {
        border: 2px solid #007bff;
        border-radius: 10px;
        padding: 2em;
        margin: 2em auto;
        max-width: 600px;
        min-height: 200px;
        text-align: center;
    }

    .question {
        font-size: 1.5em;
        font-weight: bold;
    }

    .answer {
        font-size: 1.2em;
        color: #28a745;
        margin-top: 1em;
    }

    .hidden {
        display: none;
    }

    .answer-status {
        margin-top: 1.5em;
        padding: 1em;
        border-radius: 5px;
        font-weight: bold;
        font-size: 1.1em;
        display: none;
    }

    .answer-status.correct {
        background-color: #d4edda;
        color: #155724;
        border: 2px solid #28a745;
        display: block;
    }

    .answer-status.incorrect {
        background-color: #f8d7da;
        color: #721c24;
        border: 2px solid #f5c6cb;
        display: block;
    }

    .progress-container {
        max-width: 600px;
        margin: 0 auto 1em;
    }

    .progress {
        height: 25px;
        background-color: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background-color: #007bff;
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    }

    .progress-text {
        text-align: center;
        margin-bottom: 0.5em;
        font-size: 1.1em;
        color: #333;
    }

    .score-display {
        text-align: center;
        margin-top: 1em;
        font-size: 1.1em;
        color: #333;
    }
</style>
<!--Making the Progress Bar-->
<h1>{{ question_set.name }}</h1>
<div class="progress-container">
    <div class="progress-text">
        Question <span id="current">1</span> of {{ questions_data|length }}
        (<span id="percentage">0</span>% complete)
    </div>
    <div class="progress">
        <div class="progress-bar" id="progressBar" style="width: 0%;">
            <span id="progressBarText">0%</span>
        </div>
    </div>
</div>
<!--Displaying the Score-->
<div class="score-display">
    <strong>Score:</strong> <span id="correct_count">0</span> correct / <span id="total_count">{{ questions_data|length
        }}</span>
</div>
<!--Flashcard Display-->
<div class="flashcard">
    <div class="question" id="question"></div>
    <div class="answer hidden" id="answer"></div>
    <div class="answer-status" id="answer_status"></div>
</div>

<div style="text-align: center; margin-top: 1em;">
    <button class="btn btn-info" onclick="toggleAnswer()">Show Answer</button>
    <button class="btn btn-success" onclick="markCorrect()" id="correct_btn" style="display:none;">Correct</button>
    <button class="btn btn-danger" onclick="markIncorrect()" id="incorrect_btn" style="display:none;">Incorrect</button>
    <button class="btn btn-secondary" onclick="prevCard()" id="prev">← Previous</button>
    <button class="btn btn-primary" onclick="nextCard()" id="next">Next →</button>
</div>
<!--JavaScript for Flashcard Functionality-->
<script>
    const questions = {{ questions_data | tojson }};
    let i = 0;
    let correct_answers = {};
// Updates the progress bar and percentage
    function updateProgress() {
        const percentage = Math.round(((i + 1) / questions.length) * 100);
        document.getElementById('percentage').textContent = percentage;
        document.getElementById('progressBar').style.width = percentage + '%';
        document.getElementById('progressBarText').textContent = percentage + '%';
    }

    function updateScore() {
        const correct_count = Object.values(correct_answers).filter(val => val === true).length;
        document.getElementById('correct_count').textContent = correct_count;
    }
// Displays the current flashcard
    function show() {
        document.getElementById('question').textContent = questions[i].question;
        document.getElementById('answer').textContent = questions[i].answer;
        document.getElementById('answer').classList.add('hidden');
        document.getElementById('correct_btn').style.display = 'none';
        document.getElementById('incorrect_btn').style.display = 'none';

        document.getElementById('answer_status').innerHTML = '';
        document.getElementById('answer_status').classList.remove('correct', 'incorrect');
        document.getElementById('current').textContent = i + 1;
        document.getElementById('prev').disabled = i === 0;
        document.getElementById('next').disabled = i === questions.length - 1;
        updateProgress();
        displayCardStatus();
    }

    function displayCardStatus() {
        const status = correct_answers[i];
        const status_element = document.getElementById('answer_status');
        if (status === true) {
            status_element.innerHTML = 'You got this one correct!';
            status_element.classList.add('correct');
            status_element.classList.remove('incorrect');
        } else if (status === false) {
            status_element.innerHTML = 'You got this one incorrect';
            status_element.classList.add('incorrect');
            status_element.classList.remove('correct');
        }
    }

    function toggleAnswer() {
        const ans = document.getElementById('answer');
        ans.classList.toggle('hidden');
        const isHidden = ans.classList.contains('hidden');
        // Only show the correct/incorrect buttons when the answer is visible
        const correctBtn = document.getElementById('correct_btn');
        const incorrectBtn = document.getElementById('incorrect_btn');
        if (!isHidden) {
            correctBtn.style.display = 'inline-block';
            incorrectBtn.style.display = 'inline-block';
        } else {
            correctBtn.style.display = 'none';
            incorrectBtn.style.display = 'none';
        }
    }

    function markCorrect() {
        correct_answers[i] = true;
        updateScore();
        document.getElementById('answer_status').innerHTML = 'You got this one correct!';
        document.getElementById('answer_status').classList.add('correct');
        document.getElementById('answer_status').classList.remove('incorrect');
    }

    function markIncorrect() {
        correct_answers[i] = false;
        updateScore();
        document.getElementById('answer_status').innerHTML = 'You got this one incorrect';
        document.getElementById('answer_status').classList.add('incorrect');
        document.getElementById('answer_status').classList.remove('correct');
    }

    function nextCard() {
        if (i < questions.length - 1) { i++; show(); }
    }

    function prevCard() {
        if (i > 0) { i--; show(); }
    }

    show();
</script>
{% endblock %}